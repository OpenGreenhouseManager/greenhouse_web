<grn-nav-bar></grn-nav-bar>
<main>
  <div class="heading">
    <h1>Smart Devices</h1>
    <p-button
      label="Add New Device"
      icon="pi pi-plus"
      (onClick)="addNewDevice()"
      class="add-button" />
  </div>
  <div class="content">
    <div class="controls">
      <input
        pInputText
        type="text"
        [(ngModel)]="searchTerm"
        placeholder="Search devices..."
        class="search-input" />
    </div>

    <p-table
      #dt
      [value]="filteredDevices()"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50]"
      [paginator]="true"
      [customSort]="true"
      (sortFunction)="customSort($event)"
      [tableStyle]="{ width: '100%', height: '100%' }"
      [loading]="loading()">
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="status" style="width: 8rem">
            <div class="flex justify-between items-center">
              Status
              <p-sortIcon field="status" />
            </div>
          </th>
          <th pSortableColumn="name" style="width: 20rem">
            <div class="flex justify-between items-center">
              Name
              <p-sortIcon field="name" />
            </div>
          </th>
          <th style="width: 25rem">
            <div class="flex justify-between items-center">
              Address
              <p-sortIcon field="address" />
            </div>
          </th>
          <th style="width: 30rem">
            <div class="flex justify-between items-center">
              Description
              <p-sortIcon field="description" />
            </div>
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-device>
        <tr
          class="clickable-row"
          (click)="navigateToDeviceDetail(device)"
          [title]="'Click to view details for ' + device.name">
          <td>
            <div class="status-indicator">
              <div
                class="status-dot"
                [style.background-color]="
                  getStatusColor(device.status || 'Unknown')
                "
                [title]="getStatusText(device.status || 'Unknown')"></div>
              <span class="status-text">{{
                getStatusText(device.status || 'Unknown')
              }}</span>
            </div>
          </td>
          <td>{{ device.name }}</td>
          <td>{{ device.address }}</td>
          <td>{{ device.description }}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="4">
            <div class="empty-message">
              <i class="pi pi-inbox" style="font-size: 2rem; color: #ccc"></i>
              <p>No devices found.</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</main>
