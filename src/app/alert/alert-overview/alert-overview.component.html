<grn-nav-bar></grn-nav-bar>
<main>
  <div class="heading">
    <h1>Alert</h1>
  </div>
  <div class="content">
    <p-dropdown
      [options]="intervals"
      [(ngModel)]="selectedInterval"
      optionLabel="label" />
    <p-table
      #dt2
      [value]="alerts()"
      dataKey="identifier"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50]"
      [paginator]="true"
      [globalFilterFields]="[
        'count',
        'identifier',
        'source',
        'first',
        'last',
        'severity',
      ]"
      [customSort]="true"
      (sortFunction)="customSort($event)"
      [tableStyle]="{ width: '75rem' }">
      <ng-template #header>
        <tr>
          <th pSortableColumn="count" style="width: 5rem">count</th>
          <th pSortableColumn="identifier" style="width: 20rem">
            <div class="flex justify-between items-center">
              identifier
              <p-sortIcon field="identifier" />
              <p-columnFilter
                type="text"
                field="identifier"
                display="menu"
                class="ml-auto"></p-columnFilter>
            </div>
          </th>
          <th pSortableColumn="source" style="width: 20rem">
            <div class="flex justify-between items-center">
              source
              <p-sortIcon field="source" />
              <p-columnFilter
                type="text"
                field="source"
                display="menu"
                class="ml-auto"></p-columnFilter>
            </div>
          </th>
          <th pSortableColumn="first" style="width: 20rem">
            <div class="flex justify-between items-center">
              first
              <p-sortIcon field="first" />
              <p-columnFilter
                type="date"
                field="first"
                display="menu"
                class="ml-auto"></p-columnFilter>
            </div>
          </th>
          <th pSortableColumn="last" style="width: 20rem">
            <div class="flex justify-between items-center">
              last
              <p-sortIcon field="last" />
              <p-columnFilter
                type="date"
                field="last"
                display="menu"
                class="ml-auto"></p-columnFilter>
            </div>
          </th>
          <th pSortableColumn="severity" style="width: 15rem">
            <div class="flex justify-between items-center">
              severity
              <p-sortIcon field="severity" />
              <p-columnFilter
                field="severity"
                matchMode="equals"
                display="menu"
                class="ml-auto">
                <ng-template #filter let-value let-filter="filterCallback">
                  <p-select
                    [(ngModel)]="selectedSeverity"
                    [options]="severityOptions"
                    (onChange)="filter($event.value)"
                    placeholder="Select Severity"
                    [showClear]="true">
                    <ng-template let-option #item>
                      <p-tag [value]="option.value" />
                    </ng-template>
                  </p-select>
                </ng-template>
              </p-columnFilter>
            </div>
          </th>
        </tr>
      </ng-template>
      <ng-template #body let-alert>
        <tr>
          <td>
            {{ alert.count }}
          </td>
          <td>
            {{ alert.identifier }}
          </td>
          <td>
            {{ display(alert.source) }}
            <p-button
              icon="pi pi-pencil"
              label="Alias"
              variant="text"
              (onClick)="editAlias(alert.source)" />
          </td>
          <td>
            {{ prittyDate(alert.first) }}
          </td>
          <td>
            {{ prittyDate(alert.last) }}
          </td>
          <td>
            <p-tag
              [value]="alert.severity"
              [severity]="severityToColor(alert.severity)">
            </p-tag>
          </td>
        </tr>
      </ng-template>
      <ng-template #emptymessage>
        <tr>
          <td colspan="6">No alerts found.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</main>
